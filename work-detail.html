
<!doctype html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Viola Totti - Opera Dettaglio</title>
  <style>
    /* Base */
    * { margin:0; padding:0; box-sizing:border-box; font-family: Arial, sans-serif; }
    body { background:#f9f9f9; color:#333; overflow-x:hidden; }
    a { color:#333; text-decoration:none; transition:opacity .2s; }
    a:hover { opacity:.75; }

    /* Header */
    header { position:fixed; inset:0 0 auto 0; z-index:1000; padding:30px 50px;
             background:rgba(249,249,249,.95); backdrop-filter: blur(10px); }
    .header-inner { display:flex; align-items:center; justify-content:space-between; }
    .brand { font-size:28px; font-weight:400; letter-spacing:1px; text-transform:uppercase; }
    nav ul { list-style:none; display:flex; gap:40px; }
    nav a { position:relative; }
    nav a::after{ content:""; position:absolute; left:0; bottom:-5px; height:1px; width:0; background:#333; transition:width .2s; }
    nav a:hover::after, nav a.active::after{ width:100%; }

    /* Page */
    .gallery-detail{ padding:150px 0 100px; }
    .exhibition-room{ max-width:1400px; margin:0 auto; display:flex; flex-direction:column; }
    .exhibition-header{ padding:0 50px 50px; display:flex; justify-content:space-between; align-items:flex-start; gap:30px; }
    .exhibition-title{ max-width:60%; }
    .exhibition-title h1{ font-size:42px; font-weight:300; margin-bottom:10px; letter-spacing:-.5px; }
    .exhibition-meta{ color:#666; margin-bottom:20px; }
    .exhibition-meta span{ margin-right:18px; }

    /* Showcase */
    .artwork-showcase{ width:100%; position:relative; background:#eee; margin-bottom:30px; overflow:hidden; display:flex; align-items:center; justify-content:center; }
    .artwork-showcase.portrait{ height:80vh; }
    .artwork-showcase.landscape{ height:70vh; }
    .artwork-showcase.video{ height:75vh; }
    .artwork-main{ width:100%; height:100%; display:flex; align-items:center; justify-content:center; position:relative; }
    .artwork-main img, .artwork-main video{ max-width:100%; max-height:100%; object-fit:contain; transition:transform .25s; cursor:zoom-in; }
    .artwork-main img.zoomed{ transform:scale(1.5); cursor:zoom-out; }

    /* Image nav over media */
    .image-nav-controls{ position:absolute; inset:0; display:flex; align-items:center; justify-content:space-between; pointer-events:none; padding:0 20px; }
    .image-nav-btn{ pointer-events:auto; width:50px; height:50px; display:inline-flex; align-items:center; justify-content:center;
                    background:rgba(255,255,255,.9); backdrop-filter: blur(10px);
                    border:1px solid rgba(0,0,0,.1); border-radius:50%; transition:.2s; opacity:.8; }
    .image-nav-btn:hover{ opacity:1; transform:scale(1.06); background:rgba(0,0,0,.85); border-color:rgba(0,0,0,.85); }
    .image-nav-btn:hover path{ stroke:#fff; }

    /* Thumbs */
    .artwork-gallery{ padding:0 50px; margin-bottom:50px; }
    .gallery-wall{ display:flex; flex-wrap:wrap; justify-content:center; gap:12px; max-width:900px; margin:0 auto; }
    .gallery-thumbnail{ position:relative; overflow:hidden; background:#eee; border:2px solid transparent; border-radius:6px; cursor:pointer; transition:.2s; }
    .gallery-thumbnail.portrait{ width:80px; height:100px; }
    .gallery-thumbnail.landscape{ width:120px; height:80px; }
    .gallery-thumbnail.active{ border-color:#333; transform:scale(1.04); box-shadow:0 4px 12px rgba(0,0,0,.15); }
    .gallery-thumbnail img, .gallery-thumbnail video{ width:100%; height:100%; object-fit:cover; }
    .thumbnail-video-badge{ position:absolute; top:4px; right:4px; background:rgba(0,0,0,.8); color:#fff; padding:1px 4px; border-radius:3px; font-size:8px; display:flex; align-items:center; gap:2px; }
    .thumbnail-video-badge svg{ width:8px; height:8px; }

    /* Details + related */
    .artwork-info{ padding:0 50px; display:flex; gap:30px; margin-bottom:100px; }
    .artwork-details{ flex:1; max-width:60%; padding-right:30px; }
    .details-title{ font-size:24px; font-weight:400; margin-bottom:16px; }
    .details-text{ font-size:16px; line-height:1.8; color:#333; margin-bottom:16px; }
    .artwork-materials{ font-style:italic; color:#666; margin:14px 0; }
    .artwork-dimensions{ color:#666; margin-bottom:6px; }
    .artwork-sidebar{ flex:1; max-width:40%; background:#f2f2f2; padding:24px; }
    .sidebar-title{ font-size:20px; font-weight:400; margin-bottom:14px; }
    .related-works{ display:grid; grid-template-columns:repeat(2,1fr); gap:16px; }
    .related-item img{ width:100%; display:block; aspect-ratio:4/5; object-fit:cover; }
    .related-item-title{ font-size:14px; text-align:center; margin-top:8px; }

    /* Work nav + back */
    .work-navigation{ padding:50px; border-top:1px solid #eee; display:flex; justify-content:space-between; }
    .nav-link{ display:flex; align-items:center; gap:12px; }
    .back-to-gallery{ text-align:center; margin-bottom:100px; }
    .gallery-btn{ display:inline-block; padding:15px 40px; border:1px solid #333; }
    .gallery-btn:hover{ background:#333; color:#fff; }

    /* Footer */
    footer{ padding:50px; background:#f2f2f2; text-align:center; color:#666; font-size:14px; }

    /* Mobile */
    .hamburger{ display:none; width:30px; height:20px; position:relative; cursor:pointer; z-index:1000; }
    .hamburger span{ position:absolute; left:0; width:100%; height:2px; background:#333; transition:.25s; }
    .hamburger span:nth-child(1){ top:0; } .hamburger span:nth-child(2), .hamburger span:nth-child(3){ top:9px; } .hamburger span:nth-child(4){ top:18px; }
    .hamburger.active span:nth-child(1), .hamburger.active span:nth-child(4){ left:50%; width:0; top:9px; }
    .hamburger.active span:nth-child(2){ transform:rotate(45deg); } .hamburger.active span:nth-child(3){ transform:rotate(-45deg); }

    @media (max-width:1024px){
      .exhibition-header{ flex-direction:column; padding:0 20px 30px; }
      .exhibition-title{ max-width:100%; }
      .artwork-info{ flex-direction:column; padding:0 20px; }
      .artwork-details, .artwork-sidebar{ max-width:100%; padding-right:0; }
      .artwork-details{ margin-bottom:40px; }
    }
    @media (max-width:768px){
      header{ padding:20px; }
      .hamburger{ display:block; }
      nav{ position:fixed; top:0; right:0; width:70%; height:100vh; background:rgba(249,249,249,.95);
           display:flex; align-items:center; justify-content:center; transform:translateX(100%); transition:transform .25s; z-index:999; }
      nav.active{ transform:translateX(0); }
      nav ul{ flex-direction:column; gap:20px; }
      .gallery-detail{ padding:120px 0 60px; }
      .exhibition-title h1{ font-size:32px; }
      .artwork-showcase{ height:50vh !important; }
      .image-nav-btn{ width:40px; height:40px; }
      .artwork-gallery{ padding:0 20px; }
      .gallery-thumbnail.portrait{ width:60px; height:75px; }
      .gallery-thumbnail.landscape{ width:90px; height:60px; }
      .work-navigation{ padding:30px 20px; flex-direction:column; align-items:center; gap:18px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <a href="index.html" class="brand-link"><h1 class="brand">Viola Totti</h1></a>
      <div class="hamburger" onclick="toggleMenu()"><span></span><span></span><span></span><span></span></div>
      <nav id="mainNav">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="works.html" class="active">Works</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="gallery-detail">
    <div class="exhibition-room">
      <div class="exhibition-header">
        <div class="exhibition-title">
          <h1 id="workTitle">Loading...</h1>
          <div class="exhibition-meta">
            <span id="workYear">-</span>
            <span id="workMedium">-</span>
          </div>
          <div class="exhibition-description" id="workDescription">Loading description...</div>
        </div>
        <div class="exhibition-navigation"></div>
      </div>

      <div class="artwork-showcase" id="artworkShowcase">
        <div class="artwork-main">
          <img id="mainArtworkImage" src="" alt="" style="display:none;" />
          <video id="mainArtworkVideo" style="display:none;" controls>
            <source src="" type="video/quicktime" />
            <source src="" type="video/mp4" />
          </video>
        </div>
        <div class="image-nav-controls">
          <a href="#" class="image-nav-btn" id="prevImageBtn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </a>
          <a href="#" class="image-nav-btn" id="nextImageBtn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 18L15 12L9 6" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </a>
        </div>
      </div>

      <div class="artwork-gallery">
        <div class="gallery-wall" id="galleryWall"></div>
      </div>

      <div class="artwork-info">
        <div class="artwork-details">
          <h2 class="details-title">About this work</h2>
          <div id="detailsContent"></div>
          <div class="artwork-materials" id="artworkMaterials">-</div>
          <div class="artwork-dimensions" id="artworkDimensions">-</div>
        </div>
        <div class="artwork-sidebar">
          <h3 class="sidebar-title">Related Works</h3>
          <div class="related-works" id="relatedWorks"></div>
        </div>
      </div>

      <div class="work-navigation">
        <div class="nav-previous"><a href="#" class="nav-link" id="prevWorkLink">◀︎ Previous Work</a></div>
        <div class="nav-next"><a href="#" class="nav-link" id="nextWorkLink">Next Work ▶︎</a></div>
      </div>

      <div class="back-to-gallery">
        <a href="works.html" class="gallery-btn">Back to Gallery</a>
      </div>
    </div>
  </div>

  <footer><p>©2025 Viola Totti - All Rights Reserved</p></footer>

  <script>
    // Mobile menu
    function toggleMenu(){
      const nav = document.getElementById('mainNav');
      const hamburger = document.querySelector('.hamburger');
      nav.classList.toggle('active');
      hamburger.classList.toggle('active');
    }
    document.addEventListener('click', function(e){
      const nav = document.getElementById('mainNav');
      const hamburger = document.querySelector('.hamburger');
      if (nav.classList.contains('active') && !nav.contains(e.target) && !hamburger.contains(e.target)){
        nav.classList.remove('active'); hamburger.classList.remove('active');
      }
    });

    document.addEventListener('DOMContentLoaded', async function(){
      let currentImageIndex = 0;
      let mediaItems = [];
      let worksList = [];
      let worksMap = {};
      let order = [];

      async function loadDB(){
        const res = await fetch('data/works.json?ts=' + Date.now(), { cache:'no-store' });
        const db = await res.json();
        worksList = Array.isArray(db.works) ? db.works : [];
        // normalize
        worksMap = {};
        worksList.forEach(w => {
          // detailText normalize
          if (Array.isArray(w.detailText)) {
            w.detailText = w.detailText.map(p => typeof p === 'string' ? p : (p && (p.paragraph || p.text)) || '').filter(Boolean);
          } else { w.detailText = []; }
          // images normalize
          if (!Array.isArray(w.images)) w.images = [];
          w.images = w.images.map(img => {
            if (typeof img === 'string') return { src: img, alt: w.title || '', type:'image', format:'portrait' };
            return { src: img.src, alt: (img.alt || w.title || ''), type: (img.type || 'image'), format: (img.format || 'portrait') };
          }).filter(it => it && it.src);
          worksMap[w.slug] = w;
        });
        order = worksList.map(w => w.slug);
      }

      function paramSlug(){
        const u = new URLSearchParams(location.search);
        return u.get('work') || (order[0] || '');
      }

      function renderWork(slug){
        const w = worksMap[slug] || worksMap[order[0]];
        if (!w){ return; }

        // Header text
        const t = id => document.getElementById(id);
        t('workTitle').textContent = w.title || '';
        t('workYear').textContent = w.year || '';
        t('workMedium').textContent = w.medium || '';
        t('workDescription').textContent = w.description || '';
        t('artworkMaterials').textContent = w.materials || '';
        t('artworkDimensions').textContent = w.dimensions || '';

        // Details paragraphs
        const details = t('detailsContent');
        details.innerHTML = '';
        (w.detailText || []).forEach(p => {
          const el = document.createElement('p');
          el.className = 'details-text';
          el.textContent = p;
          details.appendChild(el);
        });

        // Showcase class
        const sc = document.getElementById('artworkShowcase');
        sc.className = 'artwork-showcase ' + (w.mediaType || 'portrait');

        // Thumbnails
        mediaItems = w.images || [];
        const wall = document.getElementById('galleryWall');
        wall.innerHTML = '';
        mediaItems.forEach((item, i) => {
          const th = document.createElement('div');
          th.className = 'gallery-thumbnail ' + (item.format || 'portrait');
          if (i === 0) th.classList.add('active');
          let node;
          if (item.type === 'video'){
            node = document.createElement('video');
            node.src = item.src;
            node.muted = true; node.preload = 'none';
            node.poster = (mediaItems.find(m => m.type==='image')?.src) || '';
            const badge = document.createElement('div');
            badge.className = 'thumbnail-video-badge';
            badge.innerHTML = '<svg viewBox="0 0 24 24"><path d="M9.5 8.5L16.5 12L9.5 15.5V8.5Z" fill="white"/></svg> Video';
            th.appendChild(badge);
          } else {
            node = document.createElement('img');
            node.src = item.src; node.alt = item.alt || w.title || '';
            node.loading = i === 0 ? 'eager' : 'lazy';
            node.decoding = 'async';
          }
          th.appendChild(node);
          th.addEventListener('click', () => setActiveMedia(i));
          wall.appendChild(th);
        });

        // Prev/Next work
        const idx = order.indexOf(slug);
        const prevIdx = idx > 0 ? idx - 1 : order.length - 1;
        const nextIdx = idx < order.length - 1 ? idx + 1 : 0;
        const prevKey = order[prevIdx];
        const nextKey = order[nextIdx];
        const prevLink = document.getElementById('prevWorkLink');
        const nextLink = document.getElementById('nextWorkLink');
        if (prevLink) prevLink.href = 'work-detail.html?work=' + prevKey;
        if (nextLink) nextLink.href = 'work-detail.html?work=' + nextKey;

        // Related
        const rel = document.getElementById('relatedWorks');
        rel.innerHTML = '';
        worksList.filter(x => x.slug !== slug).forEach(x => {
          const a = document.createElement('a');
          a.href = 'work-detail.html?work=' + x.slug;
          a.className = 'related-item';
          const cover = (x.images && x.images[0] && x.images[0].src) || '';
          const img = document.createElement('img'); img.src = cover; img.alt = x.title || '';
          const title = document.createElement('div'); title.className = 'related-item-title'; title.textContent = x.title || '';
          a.appendChild(img); a.appendChild(title);
          rel.appendChild(a);
        });

        // First media
        setActiveMedia(0);
      }

      function setActiveMedia(i){
        if (!mediaItems.length) return;
        const item = mediaItems[i];
        const mainImg = document.getElementById('mainArtworkImage');
        const mainVideo = document.getElementById('mainArtworkVideo');
        mainImg.style.display = 'none';
        mainVideo.style.display = 'none';
        if (item.type === 'video'){
          mainVideo.style.display = 'block';
          const sources = mainVideo.querySelectorAll('source');
          if (sources.length >= 2){
            sources[0].src = item.src;
            sources[1].src = item.src.replace(/\.mov$/i, '.mp4');
          } else { mainVideo.src = item.src; }
          mainVideo.load();
        } else {
          mainImg.style.display = 'block';
          mainImg.src = item.src;
          mainImg.alt = item.alt || '';
          mainImg.classList.remove('zoomed');
        }
        document.querySelectorAll('.gallery-thumbnail').forEach((el, idx) => el.classList.toggle('active', idx === i));
        currentImageIndex = i;
      }

      // Image nav
      const prevBtn = document.getElementById('prevImageBtn');
      const nextBtn = document.getElementById('nextImageBtn');
      if (prevBtn && nextBtn){
        prevBtn.addEventListener('click', e => { e.preventDefault(); setActiveMedia((currentImageIndex - 1 + mediaItems.length) % mediaItems.length); });
        nextBtn.addEventListener('click', e => { e.preventDefault(); setActiveMedia((currentImageIndex + 1) % mediaItems.length); });
      }

      // Keyboard
      document.addEventListener('keydown', e => {
        if (['INPUT','TEXTAREA'].includes(e.target.tagName)) return;
        if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') { e.preventDefault(); if (prevBtn) prevBtn.click(); }
        if (e.key === 'ArrowRight' || e.key === 'ArrowDown') { e.preventDefault(); if (nextBtn) nextBtn.click(); }
        if (e.key === 'Escape') { const img = document.getElementById('mainArtworkImage'); img && img.classList.remove('zoomed'); }
      });

      // Swipe
      let sx=0, sy=0, ex=0, ey=0;
      const area = document.querySelector('.artwork-main');
      if (area){
        area.addEventListener('touchstart', e => { sx = e.changedTouches[0].screenX; sy = e.changedTouches[0].screenY; }, { passive:true });
        area.addEventListener('touchend', e => {
          ex = e.changedTouches[0].screenX; ey = e.changedTouches[0].screenY;
          const hx = Math.abs(ex - sx), hy = Math.abs(ey - sy);
          if (hx > hy && hx > 50){ if (ex < sx) nextBtn && nextBtn.click(); else prevBtn && prevBtn.click(); }
        }, { passive:true });
      }

      // Zoom toggle
      document.addEventListener('click', e => { if (e.target && e.target.id === 'mainArtworkImage') e.target.classList.toggle('zoomed'); });

      // Lazy video preload
      function setupVideoObserver(){
        const vids = document.querySelectorAll('video[preload="none"]');
        const obs = new IntersectionObserver(entries => {
          entries.forEach(en => { if (en.isIntersecting){ en.target.preload = 'metadata'; obs.unobserve(en.target); } });
        });
        vids.forEach(v => obs.observe(v));
      }

      // Boot
      await loadDB();
      renderWork(paramSlug());
      setTimeout(setupVideoObserver, 400);
    });
  </script>
</body>
</html>
